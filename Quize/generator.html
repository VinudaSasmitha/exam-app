<!DOCTYPE html>
<html lang="si">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Fix O/L Generator</title>
    <style>
        body {
            background: #111;
            color: white;
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
        }

        .box {
            background: #222;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            margin: auto;
            border: 1px solid #444;
        }

        input {
            padding: 15px;
            width: 80%;
            border-radius: 5px;
            border: none;
            text-align: center;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        select {
            padding: 15px;
            width: 85%;
            border-radius: 5px;
            font-size: 1rem;
            margin-bottom: 20px;
        }

        button {
            padding: 15px 40px;
            background: #00d2d3;
            border: none;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            font-size: 1.2rem;
            color: #000;
            width: 85%;
        }

        button:hover {
            background: #0acaa8;
        }

        #status {
            margin-top: 20px;
            padding: 15px;
            background: #000;
            color: #00d2d3;
            font-family: monospace;
            text-align: left;
            border-radius: 5px;
            min-height: 100px;
            white-space: pre-wrap;
        }

        .error {
            color: #ff4757 !important;
        }

        .success {
            color: #2ed573 !important;
        }
    </style>
</head>

<body>

    <div class="box">
        <h2>üõ†Ô∏è Final Test Run</h2>
        <p style="color:#aaa;">‡∂Ö‡∂Ω‡∑î‡∂≠‡∑ä Key ‡∂ë‡∂ö ‡∂Ø‡∑è‡∂Ω‡∑è 'Start' ‡∂î‡∂∂‡∂±‡∑ä‡∂±.</p>

        <input type="text" id="apiKey" placeholder="Paste New API Key Here (AIzaSy...)" value="">

        <select id="subject">
            <option value="Science">Science (‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä)</option>
            <option value="History">History (‡∂â‡∂≠‡∑í‡∑Ñ‡∑è‡∑É‡∂∫)</option>
            <option value="Buddhism">Buddhism (‡∂∂‡∑î‡∂Ø‡∑ä‡∂∞‡∑è‡∂ú‡∂∏)</option>
            <option value="Sinhala">Sinhala (‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω)</option>
        </select>

        <button onclick="runTest()">üöÄ Start Magic</button>

        <div id="status">Waiting for input...</div>
    </div>

    <script>
        function log(msg, type = "") {
            const el = document.getElementById("status");
            if (type === "error") {
                el.innerHTML = `<span class="error">‚ùå ${msg}</span>`;
            } else if (type === "success") {
                el.innerHTML = `<span class="success">‚úÖ ${msg}</span>`;
            } else {
                el.innerHTML = `> ${msg}`;
            }
        }

        async function runTest() {
            const key = document.getElementById('apiKey').value.trim();
            const subject = document.getElementById('subject').value;

            if (key.length < 10) {
                log("API Key ‡∂ë‡∂ö ‡∂Ø‡∑è‡∂Ω‡∑è ‡∂±‡∑ë! ‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª Key ‡∂ë‡∂ö Paste ‡∂ö‡∂ª‡∂±‡∑ä‡∂±.", "error");
                return;
            }

            log("Connecting to Google AI...");

            const prompt = `Generate 5 O/L ${subject} Multiple Choice Questions in Sinhala. Output JSON.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                if (!response.ok) {
                    const errData = await response.json();
                    console.error(errData);
                    // ‡∑Ñ‡∂ª‡∑í‡∂∫‡∂ß‡∂∏ Error ‡∂ë‡∂ö ‡∂ö‡∑í‡∂∫‡∂±‡∑Ä‡∑è
                    log(`Failed! Google Error:\n${errData.error.message}\n\nCode: ${response.status}`, "error");
                    return;
                }

                const data = await response.json();
                log("Success! Questions Generated. Downloading...", "success");

                // Download File
                const text = JSON.stringify(data, null, 2);
                const blob = new Blob([text], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `OL_${subject}_Questions.json`;
                link.click();

            } catch (e) {
                log(`Network Error! ‡∂Ö‡∂±‡∑ä‡∂≠‡∂ª‡∑ä‡∂¢‡∑è‡∂Ω ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞‡∂≠‡∑è‡∑Ä‡∂∫ ‡∂∂‡∂Ω‡∂±‡∑ä‡∂±.\n${e.message}`, "error");
            }
        }
    </script>

</body>

</html>